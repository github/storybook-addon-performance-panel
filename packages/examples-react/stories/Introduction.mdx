import {Meta} from '@storybook/addon-docs/blocks'

<Meta title="Introduction" />

# Performance Panel Addon

A Storybook addon that provides real-time performance monitoring for stories. It displays comprehensive metrics including frame timing, input responsiveness, memory usage, React profiling, and more.

The metrics panel appears as a **âš¡ Performance** tab at the bottom of Storybook when viewing any story.

## Quick Start

```bash
npm install @github-ui/storybook-addon-performance-panel
```

### React projects

Register the addon panel in your Storybook main config:

```ts
// .storybook/main.ts
const config = {
  addons: ['@github-ui/storybook-addon-performance-panel'],
}
```

Compose the addon in your preview for the decorator and full type inference:

```ts
// .storybook/preview.ts
import addonPerformancePanel from '@github-ui/storybook-addon-performance-panel'
import {definePreview} from '@storybook/react-vite'

export default definePreview({
  addons: [addonPerformancePanel()],
})
```

All stories automatically get performance monitoring. Use `preview.meta()` and `meta.story()` for the CSF factory API.

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preview Iframe (Decorator)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ PerformanceProvider â”‚â”€â”€â”€â–¶â”‚ Metrics Collection          â”‚    â”‚
â”‚  â”‚   â””â”€ProfiledComponentâ”‚   â”‚  â€¢ RAF loop (frame timing)  â”‚    â”‚
â”‚  â”‚       â””â”€Story       â”‚   â”‚  â€¢ PerformanceObservers     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â€¢ MutationObservers        â”‚    â”‚
â”‚                             â”‚  â€¢ Event listeners          â”‚    â”‚
â”‚                             â”‚  â€¢ React Profiler API       â”‚    â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                            â”‚                    â”‚
â”‚                              channel.emit(METRICS_UPDATE)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Manager (Panel)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ PerformancePanel    â”‚â—€â”€â”€ useChannel(METRICS_UPDATE)          â”‚
â”‚  â”‚   â””â”€MetricsSections â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Metrics At a Glance

<table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Key Metrics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Frame Timing</strong></td>
      <td>FPS, frame time, dropped frames, jitter, stability</td>
    </tr>
    <tr>
      <td><strong>Input</strong></td>
      <td>INP, input latency, FID, interaction breakdown</td>
    </tr>
    <tr>
      <td><strong>Main Thread</strong></td>
      <td>Long tasks, TBT, thrashing, DOM churn</td>
    </tr>
    <tr>
      <td><strong>Long Animation Frames</strong></td>
      <td>LoAF count, blocking duration, script attribution</td>
    </tr>
    <tr>
      <td><strong>Layout Stability</strong></td>
      <td>CLS, forced reflows, style writes</td>
    </tr>
    <tr>
      <td><strong>React</strong></td>
      <td>Mount time, slow updates, P95 duration, render cascades</td>
    </tr>
    <tr>
      <td><strong>Memory</strong></td>
      <td>Heap usage, delta, GC pressure, compositor layers</td>
    </tr>
  </tbody>
</table>


## Metric Thresholds

Metrics are color-coded based on Web Vitals standards:

<table>
  <thead>
    <tr>
      <th>Metric</th>
      <th>ğŸŸ¢ Good</th>
      <th>ğŸŸ¡ Needs Work</th>
      <th>ğŸ”´ Poor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>FPS</td>
      <td>â‰¥55</td>
      <td>30â€“55</td>
      <td>&lt;30</td>
    </tr>
    <tr>
      <td>Frame Time</td>
      <td>â‰¤16.67ms</td>
      <td>16.67â€“32ms</td>
      <td>&gt;32ms</td>
    </tr>
    <tr>
      <td>Input Latency</td>
      <td>â‰¤16ms</td>
      <td>16â€“50ms</td>
      <td>&gt;50ms</td>
    </tr>
    <tr>
      <td>INP</td>
      <td>â‰¤200ms</td>
      <td>200â€“500ms</td>
      <td>&gt;500ms</td>
    </tr>
    <tr>
      <td>CLS</td>
      <td>&lt;0.1</td>
      <td>0.1â€“0.25</td>
      <td>&gt;0.25</td>
    </tr>
    <tr>
      <td>TBT</td>
      <td>&lt;200ms</td>
      <td>200â€“600ms</td>
      <td>&gt;600ms</td>
    </tr>
  </tbody>
</table>


## Browser Compatibility

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>Chrome/Edge</th>
      <th>Firefox</th>
      <th>Safari</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Core metrics</td>
      <td>âœ…</td>
      <td>âœ…</td>
      <td>âœ…</td>
    </tr>
    <tr>
      <td>Memory API</td>
      <td>âœ…</td>
      <td>âŒ</td>
      <td>âŒ</td>
    </tr>
    <tr>
      <td>Long Animation Frames</td>
      <td>âœ… 123+</td>
      <td>âŒ</td>
      <td>âŒ</td>
    </tr>
    <tr>
      <td>Event Timing (INP)</td>
      <td>âœ…</td>
      <td>âœ… 144+</td>
      <td>âŒ</td>
    </tr>
    <tr>
      <td>Element Timing</td>
      <td>âœ…</td>
      <td>âŒ</td>
      <td>âŒ</td>
    </tr>
  </tbody>
</table>


**Chrome/Edge is recommended** for the most complete metrics during debugging.
