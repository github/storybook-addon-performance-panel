import {Meta} from '@storybook/addon-docs/blocks'

<Meta title="Introduction" />

# Performance Panel Addon

A Storybook addon that provides real-time performance monitoring for stories. It displays comprehensive metrics including frame timing, input responsiveness, memory usage, React profiling, and more.

The metrics panel appears as a **âš¡ Performance** tab at the bottom of Storybook when viewing any story.

## Quick Start

```bash
npm install @github-ui/storybook-addon-performance-panel
```

Add the addon to your Storybook configuration:

```ts
// .storybook/main.ts
const config = {
  addons: ['@github-ui/storybook-addon-performance-panel'],
}
```

And compose it in your preview for full type inference:

```ts
// .storybook/preview.ts
import {definePreview} from '@storybook/react-vite'
import addonPerformancePanel from '@github-ui/storybook-addon-performance-panel'

export default definePreview({
  addons: [addonPerformancePanel()],
})
```

That's it â€” all stories automatically get performance monitoring.

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preview Iframe (Decorator)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ PerformanceProvider â”‚â”€â”€â”€â–¶â”‚ Metrics Collection          â”‚    â”‚
â”‚  â”‚   â””â”€ProfiledComponentâ”‚   â”‚  â€¢ RAF loop (frame timing)  â”‚    â”‚
â”‚  â”‚       â””â”€Story       â”‚   â”‚  â€¢ PerformanceObservers     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â€¢ MutationObservers        â”‚    â”‚
â”‚                             â”‚  â€¢ Event listeners          â”‚    â”‚
â”‚                             â”‚  â€¢ React Profiler API       â”‚    â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                            â”‚                    â”‚
â”‚                              channel.emit(METRICS_UPDATE)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Manager (Panel)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ PerformancePanel    â”‚â—€â”€â”€ useChannel(METRICS_UPDATE)          â”‚
â”‚  â”‚   â””â”€MetricsSections â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Metrics At a Glance

| Category | Key Metrics |
|----------|-------------|
| **Frame Timing** | FPS, frame time, dropped frames, jitter, stability |
| **Input** | INP, input latency, FID, interaction breakdown |
| **Main Thread** | Long tasks, TBT, thrashing, DOM churn |
| **Long Animation Frames** | LoAF count, blocking duration, script attribution |
| **Layout Stability** | CLS, forced reflows, style writes |
| **React** | Mount time, slow updates, P95 duration, render cascades |
| **Memory** | Heap usage, delta, GC pressure, compositor layers |

## Metric Thresholds

Metrics are color-coded based on Web Vitals standards:

| Metric | ğŸŸ¢ Good | ğŸŸ¡ Needs Work | ğŸ”´ Poor |
|--------|------|------------|------|
| FPS | â‰¥55 | 30â€“55 | &lt;30 |
| Frame Time | â‰¤16.67ms | 16.67â€“32ms | &gt;32ms |
| Input Latency | â‰¤16ms | 16â€“50ms | &gt;50ms |
| INP | â‰¤200ms | 200â€“500ms | &gt;500ms |
| CLS | &lt;0.1 | 0.1â€“0.25 | &gt;0.25 |
| TBT | &lt;200ms | 200â€“600ms | &gt;600ms |

## Browser Compatibility

| Feature | Chrome/Edge | Firefox | Safari |
|---------|-------------|---------|--------|
| Core metrics | âœ… | âœ… | âœ… |
| Memory API | âœ… | âŒ | âŒ |
| Long Animation Frames | âœ… 123+ | âŒ | âŒ |
| Event Timing (INP) | âœ… | âœ… 144+ | âŒ |
| Element Timing | âœ… | âŒ | âŒ |

**Chrome/Edge is recommended** for the most complete metrics during debugging.
